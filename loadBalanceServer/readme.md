# 负载均衡服务器中间组件
### <font color=blue>引入负载均衡服务器的缘由？</font>

为了实现高并发，基于C/S服务器模型的演变过程是这样的
单机服务器->集群服务器->分布式服务器集群

尽管集群服务器相对于单机服务器来讲，在并发量上有了显著的提高，降低每一个服务器的单机压力。
但是如果分配不当，任然可能造成个别的服务器压力过高，甚至出现宕机的情况。因此，为了均衡
集群服务器中单机的压力，对集群服务器做负载均衡的管理。这样就可以使得每台服务器上所连接的
客户端个数相对均衡，不会出现个别服务器压力过高的情况。


### <font color=blue>一致性hash解决了什么问题？</font>
#### 1.首先来看一下普通的hash算法，如果我们三台服务器，编号分别为0,1,2。当客户端连接时，将其ip+port做成一个key, hash(key) = value, 如key%3=(0,1,2)。这样就可以实现一个简单的负载算法了，但是<font color=green>如果新增加服务器节点，哈希算法会发生变化。</font>同一个客户端再次连接服务器就不会连接到之前的服务器了，如果这种场景是在缓存系统中，那么就需要更改所有的缓存位置，显然这样的哈希算法是不合理的。
#### 2.一致性hash算法，在一个2^32大一个虚拟的环上，对服务器节点进行分布，(ip+port) % 2^32 = value。通过value定位服务器的位置。<font color=green>客户端连接服务器，将客户端的(ip+port)%2^32=value,在hash环上找到大于等于value的第一个物理服务器进行连接。</font>这样做的好处，当新增物理服务器节点时，只会影响到新增物理服务器节点的下一个位置物理服务器节点的一部分查询位置，但是相对于整个一致性hash环影响并不是很大。
#### 3.hash偏斜 尽管一致性hash环解决了之前的问题，但是如果选择不到合适的hash算法，有可能出现这样的一种情况，一致性hash环上物理服务器节点聚簇在环上的一部分，这样就导致处于开头的服务器压力相对其他服务器压力很大。<font color=green>如何解决？增加虚拟节点，对于每个物理服务器节点增加一定数量的虚拟节点，虚拟节点中有指向物理节点的指针，这样对服务器进行平均，就可以使得hash环上每台物理服务器都能够负载的均衡，达到了分布式管理集群服务器的目的了。



### <font color=red>类</font>
#### 1.PysicalNode 实体节点类 代表了一致性hash环上的一个物理节点，真实存在的服务器
#### 2.VirtualNode 虚拟节点类 代表了一致性hash换上的一个虚拟节点，解决hash偏斜的问题
#### 3.HashFunction 哈希函数  哈希算法
#### 4.MD5HashFunction 基于md5算法的哈希函数 
#### 5.ConsistenHashCircle 一致性哈希环类
#### 6.LoadBalanceServer 负载均衡服务器类